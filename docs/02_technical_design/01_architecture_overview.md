# アーキテクチャ概要

# マインスイーパーアーキテクチャ概要

本プロジェクトのアーキテクチャは、クライアントサイドで完結するマインスイーパーゲームの実装を目指し、将来的な拡張性も考慮しています。

## アーキテクチャの基本原則

- **クライアントサイドレンダリング** - Next.jsのクライアントコンポーネントを使用
- **ロジックとUIの分離** - ゲームロジックとUI表現を明確に分離
- **ハイブリッド状態管理** - カスタムフックと部分的なreducerパターンの組み合わせ
- **ノードベースのグリッド設計** - 将来的な形状拡張性を考慮したノード・エッジモデル

## プロジェクト構造

```
src/
├─ app/
│   ├─ page.tsx           # メインページ
│   ├─ layout.tsx         # レイアウト
│   └─ globals.css        # グローバルスタイル
├─ components/
│   ├─ Game/              # ゲーム関連コンポーネント
│   │   ├─ Board.tsx      # ゲームボード
│   │   ├─ Cell.tsx       # 各マス目
│   │   ├─ Controls.tsx   # 操作パネル
│   │   ├─ Counter.tsx    # 地雷カウンターとタイマー
│   │   └─ index.tsx      # ゲームコンテナ
│   └─ UI/                # 共通UI要素
│       ├─ Button.tsx
│       ├─ Modal.tsx      # 結果表示やヘルプなど
│       └─ ThemeToggle.tsx # テーマ切り替え
├─ contexts/
│   └─ GameContext.tsx    # ゲーム状態管理
├─ hooks/
│   ├─ useGame.ts         # ゲームロジック
│   └─ useTimer.ts        # タイマー機能
├─ types/
│   └─ index.ts           # 型定義
├─ models/
│   ├─ grid/               # グリッド関連モデル
│   │   ├─ IGrid.ts        # グリッドインターフェース
│   │   ├─ SquareGrid.ts   # 正方形グリッド実装
│   │   └─ GridFactory.ts  # グリッドファクトリ
│   └─ node/               # ノード（セル）関連モデル
│       ├─ INode.ts        # ノードインターフェース
│       └─ SquareNode.ts   # 正方形ノード実装
└─ utils/
    ├─ gameHelpers.ts     # ゲーム関連ヘルパー関数
    └─ constants.ts       # 定数
```

## レイヤー構造

アーキテクチャは以下のレイヤーで構成されます：

1. **コアロジック層** - モデル層とも呼ばれ、ゲームの状態、ルール、操作に関するすべてのロジックを含みます。具体的にはグリッドやノードのモデルがここに含まれます。
2. **コントローラー層** - useGameカスタムフックやreducerなど、ユーザー入力をコアロジックへの呼び出しに変換するレイヤー。
3. **UI表現層** - Reactコンポーネントがゲーム状態を視覚的に表現します。これはCSSやアニメーションなどの表現に関するすべての要素を含みます。

## データフロー

データは以下のようにアプリケーション内を流れます：

1. ユーザーアクション（クリック、フラグ設置など）はUIコンポーネントでキャプチャ
2. UIコンポーネントはコンテキストまたはカスタムフックを通じてアクションをを発行
3. アクションはコアロジックで処理され、ゲーム状態を更新
4. 更新された状態はコンテキストを通じてUIコンポーネントに反映されます

## システム拡張性

本アーキテクチャは以下の拡張ポイントを実現するために設計されています：

- **形状の拡張** - IGridおよびINodeインターフェースを通じて、将来的に六角形や三角形のマスを提供できるように設計
- **難易度モード** - カスタム難易度を含む様々な難易度レベルの追加が容易
- **テーマ対応** - Tailwind CSSを活用した様々なテーマの追加が可能
- **オフライン対応** - PWA化とローカルストレージの実装によりオフラインプレイに対応可能